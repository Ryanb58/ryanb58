
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="index, follow" />

  <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,400italic' rel='stylesheet' type='text/css'>

    <link rel="stylesheet" type="text/css" href="https://taylorbrazelton.com/theme/stylesheet/style.min.css">

  <link rel="stylesheet" type="text/css" href="https://taylorbrazelton.com/theme/pygments/github.min.css">
  <link rel="stylesheet" type="text/css" href="https://taylorbrazelton.com/theme/font-awesome/css/font-awesome.min.css">


    <link href="https://taylorbrazelton.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="TAYLOR BRAZELTON Atom">



<!-- Google Analytics -->
<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-52478838-2', 'auto');
  ga('send', 'pageview');
</script>
<!-- End Google Analytics -->

    <meta name="author" content="Taylor Brazelton" />
    <meta name="description" content="Taylor Brazelton tries to make sense of computers and the internet. What could possibly go wrong?" />
<meta property="og:site_name" content="TAYLOR BRAZELTON"/>
<meta property="og:type" content="blog"/>
<meta property="og:title" content="TAYLOR BRAZELTON"/>
<meta property="og:description" content="Taylor Brazelton tries to make sense of computers and the internet. What could possibly go wrong?"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="https://taylorbrazelton.com"/>
<meta property="og:image" content="https://s.gravatar.com/avatar/3f9df5012e11231e7c9ce7e8ef42135e?s=120">

  <title>TAYLOR BRAZELTON &ndash;     Tag swarm
</title>

</head>
<body>
  <aside>
    <div>
      <a href="https://taylorbrazelton.com">
        <img src="https://s.gravatar.com/avatar/3f9df5012e11231e7c9ce7e8ef42135e?s=120" alt="Taylor Brazelton" title="Taylor Brazelton">
      </a>
      <h1><a href="https://taylorbrazelton.com">Taylor Brazelton</a></h1>

<p>zeros and ones</p>
      <nav>
        <ul class="list">
          <li><a href="https://taylorbrazelton.com/pages/about-me.html#about-me">About Me</a></li>

        </ul>
      </nav>

      <ul class="social">
        <li><a class="sc-linkedin" href="https://www.linkedin.com/in/taylorbrazelton" target="_blank"><i class="fa fa-linkedin"></i></a></li>
        <li><a class="sc-github" href="http://github.com/ryanb58" target="_blank"><i class="fa fa-github"></i></a></li>
        <li><a class="sc-twitter" href="http://twitter.com/Ryanb58" target="_blank"><i class="fa fa-twitter"></i></a></li>
      </ul>
    </div>


  </aside>
  <main>

    <nav>
      <a href="https://taylorbrazelton.com">    Home
</a>

      <a href="/archives.html">Archives</a>
      <a href="/categories.html">Categories</a>
      <a href="/tags.html">Tags</a>

      <a href="https://taylorbrazelton.com/feeds/all.atom.xml">    Atom
</a>

    </nav>



<article>
  <header>
    <h2><a href="https://taylorbrazelton.com/2018/Mar/02/django-migrations-downgrade-in-docker-swarm/#django-migrations-downgrade-in-docker-swarm">Django Migrations Downgrade in Docker Swarm</a></h2>
    <p>
          Posted on Fri 02 March 2018 in <a href="https://taylorbrazelton.com/category/django.html">django</a>


          &#8226;     Tagged with

              <a href="https://taylorbrazelton.com/tag/docker.html">docker</a>,              <a href="https://taylorbrazelton.com/tag/django.html">django</a>,              <a href="https://taylorbrazelton.com/tag/python.html">python</a>,              <a href="https://taylorbrazelton.com/tag/downgrade.html">downgrade</a>,              <a href="https://taylorbrazelton.com/tag/swarm.html">swarm</a>,              <a href="https://taylorbrazelton.com/tag/orchestration.html">orchestration</a>
    </p>
  </header>
  <div>
      <p>Edge cases are a big problem in software engineering, one that I recently ran
into while on a beta box was errors being thrown after a downgrade.</p>
<p>First a little background on the application. It is a django application running
in a docker container via docker-swarm. Our application upgrade/downgrade
process is to reduce the amount of containers running down to 0. Change the
tag numbers in our .yml file and then scale them back up. This forces the
containers to download the newly defined version. Note that our downgrade
process is exactly the same we just update the a tag with an older version.</p>
<p>The process described above might sound correct to you, however, because we use migrations
to structure our database the process is flawed. By replaceing the tag and
just moving to older docker containers, the downgrade function inside our
migrations never get ran. Instead the downgraded application has no idea
about the migrations that existed in the newer version that does not in it's
own. Thus resulting in an inconsistant database state with the version of
application deployed.</p>
<p>My current solution to this issue is to run the migration downgrade for each
app in our django project manually inside of the existing application container
. To do this I start out with a diff of the code between the old version and
the new version. I look for any added migrations and run the command below to
have django south run through the downgrade methods until it reaches the
latest migration in the old code. Then I perform the old migration method.</p>
<p>Here is a step by step list of the process.</p>
<p>1) Diff of code.</p>
<p>2) Write down oldest added migration number and app name</p>
<p>3) Exec into the application docker container.</p>
<p>4) Migrate backwards :</p>
<div class="highlight"><pre><span></span>./manage.py migrate appname 0000
</pre></div>


<p>5) Exit out of container.</p>
<p>6) Scale the swarm down to 0 nodes.</p>
<p>7) Change tag number.</p>
<p>8) Scale the containers back up.</p>
<p>Do you have any suggestions or any improvements to this process? Comment below
and link me to other articles you've read about this process. The more we know
together the better our overall solutions can be.</p>
      <br>
      <a class="btn" href="https://taylorbrazelton.com/2018/Mar/02/django-migrations-downgrade-in-docker-swarm/#django-migrations-downgrade-in-docker-swarm">    Continue reading
</a>
  </div>
</article>

  <div class="pagination">
  </div>




    <footer>
<p>&copy;  </p>
<p>    Powered by <a href="http://getpelican.com" target="_blank">Pelican</a> - <a href="https://github.com/alexandrevicenzi/flex" target="_blank">Flex</a> theme by <a href="http://alexandrevicenzi.com" target="_blank">Alexandre Vicenzi</a>
</p>    </footer>
  </main>




<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " TAYLOR BRAZELTON ",
  "url" : "https://taylorbrazelton.com",
  "image": "https://s.gravatar.com/avatar/3f9df5012e11231e7c9ce7e8ef42135e?s=120",
  "description": "Taylor Brazelton tries to make sense of computers and the internet. What could possibly go wrong?"
}
</script>

</body>
</html>